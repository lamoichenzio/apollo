<html xmlns:th="http://www.thymeleaf.org">
<body>
	<div th:fragment="form" title="group-container">
		<form th:action="@{/answers/survey/create}" method="post"
			th:object="${surveyanswer}" id="form">
			<input type="hidden" th:field="*{survey}">
			<!-- Iterate Question Groups -->
			<div th:each="group, groupStat : ${survey.questionGroups}"
				class="tab card-body pb-0">
				<div class="row">
					<div class="col-10">
						<h5 class="mb-1 p-1">[[${groupStat.index+1}+'.
							'+${group.title}]]</h5>
						<h6 class="text-muted mb-3 p-1">[[${group.description}]]</h6>
					</div>
				</div>

				<div class="card border mb-0 shadow-none bg-gray-100">
					<div
						class="card-body row align-items-center mx-2 justify-content-center">
						<!-- Iterate questions of the group -->
						<div class="col-12"
							th:each="question, questionStat : ${survey.questionGroups[__${groupStat.index}__].questions}">

							<div class="row align-items-center mx-0 justify-content-center">
								<div class="col-10 card border shadow-none p-3">
									<!-- TITLE -->
									<div class="m-1">
										<h6 class="mb-0"
											th:text="${groupStat.index+1}+'.'+${questionStat.index+1}+'. '+${question.title}"></h6>
									</div>
									<!-- Show image if exists -->
									<div class="m-5" th:if="${question.file != null}">
										<img th:src="${'data:image/png;base64,'+question.file.data}"
											width="50%">
									</div>
									<div class="row">
										<div class="col-10 mx-1 px-2 py-3">

											<!-- If Input Question -->
											<div
												th:if="${question instanceof T(it.univaq.disim.mwt.apollo.domain.questions.InputQuestion)}"
												th:replace="~{common/user_view/components/text_question :: question(question=${question}, stat=${questionStat})}">
											</div>

											<!-- If Choice Question -->
											<div
												th:if="${question instanceof T(it.univaq.disim.mwt.apollo.domain.questions.ChoiceQuestion)}">
												<!-- If Radio -->
												<div
													th:if="${question.choiceType == T(it.univaq.disim.mwt.apollo.domain.questions.ChoiceType).RADIO}"
													th:replace="~{common/user_view/components/radio_question.html :: question(question=${question}, stat=${questionStat})}">
												</div>
												<!-- If Check -->
												<div
													th:if="${question.choiceType == T(it.univaq.disim.mwt.apollo.domain.questions.ChoiceType).CHECK}"
													th:replace="~{common/user_view/components/check_question.html :: question(question=${question}, stat=${questionStat})}">
												</div>
											</div>
											<!-- If Select Question -->
											<div
												th:if="${question instanceof T(it.univaq.disim.mwt.apollo.domain.questions.SelectionQuestion)}"
												th:replace="~{common/user_view/components/select_question.html :: question(question=${question}, stat=${questionStat})}">
											</div>
											<!-- If Matrix Question -->
											<div
												th:if="${question instanceof T(it.univaq.disim.mwt.apollo.domain.questions.MatrixQuestion)}">
												<!-- If Radio -->
												<div
													th:if="${question.type == T(it.univaq.disim.mwt.apollo.domain.questions.ChoiceType).RADIO}"
													th:replace="~{common/user_view/components/matrix_radio_question.html :: question(question=${question}, stat=${questionStat})}">
												</div>
												<!-- If Check -->
												<div
													th:if="${question.type == T(it.univaq.disim.mwt.apollo.domain.questions.ChoiceType).CHECK}"
													th:replace="~{common/user_view/components/matrix_check_question.html :: question(question=${question}, stat=${questionStat})}">
												</div>
											</div>

										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="m-4">
						<button type="button" id="prevBtn"
							class="btn btn-sm btn-primary btn-icon rounded-pill"
							th:text="#{common.previous}" onclick="nextPrev(-1)">Previous</button>
						<button type="button" id="nextBtn"
							class="btn btn-sm btn-primary btn-icon rounded-pill"
							onclick="nextPrev(1)"></button>
						<!-- <button type="submit"
							class="btn btn-sm btn-primary btn-icon rounded-pill"
							th:text="#{common.submit}"></button> -->
					</div>
					<!-- Circles which indicates the steps of the form: -->
				</div>
				<div style="text-align: center" class="m-4">
					<span class="step"
						th:each="questionGroup : ${survey.questionGroups}"></span>
				</div>
			</div>

		</form>
		<script th:inline="javascript">
			var currentTab = 0; 
			showTab(currentTab);
	
			function showTab(n) {
				var x = $(".tab");
				x[n].style.display = "block";
				if (n == 0) {
					$("#prevBtn").css("display", "none");
				} else {
					$("#prevBtn").css("display", "inline");
				}
				if (n == (x.length - 1)) {
					$("#nextBtn").html([[#{common.next}]]);
				} else {
					$("#nextBtn").html([[#{common.next}]]);
				}
				fixStepIndicator(n)
			}
	
			function nextPrev(n) {
				var x = $(".tab");
				x[currentTab].style.display="none";
				currentTab = currentTab + n;
				if (currentTab >= x.length) {
					$("#form").submit();
					return false;
				}
				showTab(currentTab);
			}
			
			function fixStepIndicator(n) {
			  // This function removes the "active" class of all steps...
			  var i, x = $(".step");
			  for (i = 0; i < x.length; i++) {
			    x[i].className = x[i].className.replace(" active", "");
			  }
			  //... and adds the "active" class to the current step:
			  x[n].className += " active";
			}
		</script>
	</div>
</body>

</html>