<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{/common/layout/frame_public}">

<body>

	<div layout:fragment="page-content">

		<!-- Page title -->
		<div class="page-title">
			<div class="row justify-content-between align-items-center">
				<div
					class="col-md-8 d-flex align-items-center justify-content-between justify-content-md-start mb-3">
					<!-- Page title + Go Back button -->
					<div class="d-inline-block p-1 mr-2">
						<a href="#" th:href="@{/surveys/dashboard}"
							class="link d-inline-block font-weight-400 mb-0 text-white">
							<i class="fas fa-arrow-left"></i>
						</a>
					</div>
					<div class="d-inline-block p-1">
						<h5 class="h4 d-inline-block font-weight-400 mb-0 text-white"
							th:text="#{common.updateprofile}"></h5>
					</div>
				</div>
			</div>
		</div>

		<div class="card p-5">
			<div class="alert alert-success alert-dismissible fade show"
					role="alert" th:if="${ok != null}">
					[[#{common.operazioneok}]]
					<button type="button" class="close" data-dismiss="alert"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
			<div class="card-body">
				<form action="#" th:action="${#request.getRequestURI()}"
					method="post" enctype="multipart/form-data" th:object="${user}">
					<input type="hidden" th:field="*{pic}" th:if="*{pic != null}">
					<!-- Change avatar -->
					<div class="card hover-shadow-lg border-0">
						<div class="card-body py-3">
							<div class="row row-grid align-items-center">
								<div class="col-lg-8">
									<div class="media align-items-center">
										<img alt="Image placeholder"
											id="pic"
											src="../../assets/img/theme/light/team-1-800x800.jpg"
											class="avatar rounded-circle avatar-lg"
											th:src="@{/dist/img/icons/user/user.png}"
											th:if="*{pic == null}"> 
											<img alt="Image placeholder"
											id="pic"
											src="../../assets/img/theme/light/team-1-800x800.jpg"
											class="avatar rounded-circle avatar-lg"
											th:src="${'data:image/jpg;base64,'+user.pic}"
											th:if="*{pic != null}">
										<div class="media-body ml-3">
											<h5 class="mb-0"
												th:if="*{firstname != null && lastname != null && firstname!='' && lastname != ''}">
												[[*{firstname}]] [[*{lastname}]]</h5>
											<div>
												<input type="file" name="icon" id="file-1"
													class="custom-input-file custom-input-file-link"
													accept="image/*"/> 
												<label for="file-1">
													<span th:text="#{common.changeavatar}">Change avatar</span>
												</label>
												<p id="filename"></p>
												<p th:if="${#fields.hasErrors('global')}" th:errors="*{global}"></p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Common Informations -->
					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label class="form-control-label" th:text="#{common.firstname}">First
									name</label> <input class="form-control" type="text"
									th:field="*{firstname}">
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label class="form-control-label" th:text="#{common.lastname}">Last
									name</label> <input class="form-control" type="text"
									th:field="*{lastname}">
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label class="form-control-label">Username</label> <input
									class="form-control" type="text" th:field="*{username}"
									required th:errorclass="is-invalid">
								<div th:if="${#fields.hasErrors('username')}"
									th:each="err: ${#fields.errors('username')}" th:utext="${err}">errors</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label class="form-control-label">Email</label> <input
									class="form-control" type="email" th:field="*{email}" required
									th:errorclass="is-invalid">
								<div th:if="${#fields.hasErrors('email')}"
									th:each="err: ${#fields.errors('email')}" th:utext="${err}">errors</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12">
							<div id="accordion-1" class="accordion">
								<div class="card">
									<div class="card-header py-4" id="heading-1-1"
										data-toggle="collapse" role="button"
										data-target="#collapse-1-1" aria-expanded="false"
										aria-controls="collapse-1-1">
										<h6 class="mb-0">
											<i class="fas fa-exclamation mr-3"></i>
											[[#{common.passwordupdate}]]
										</h6>
									</div>
									<div id="collapse-1-1" class="collapse"
										aria-labelledby="heading-1-1" data-parent="#accordion-1">
										<div class="card-body">
											<div class="form-group">
												<label class="form-control-label"
													th:text="#{common.oldpassword}">Old Password</label> <input
													class="form-control" type="password"
													th:field="*{oldPassword}" th:errorclass="is-invalid">
												<div th:if="${#fields.hasErrors('oldPassword')}"
													th:each="err: ${#fields.errors('oldPassword')}"
													th:utext="${err}">errors</div>
											</div>
											<div class="form-group">
												<label class="form-control-label"
													th:text="#{common.newpassword}">New Password</label> <input
													class="form-control" type="password"
													th:field="*{newPassword}">
											</div>
											<div class="form-group">
												<label class="form-control-label"
													th:text="#{common.passwordconfirm}">New Password
													Confirm</label> <input class="form-control" type="password"
													th:field="*{passwordConfirm}" th:errorclass="is-invalid">
												<div th:if="${#fields.hasErrors('passwordConfirm')}"
													th:each="err: ${#fields.errors('passwordConfirm')}"
													th:utext="${err}">errors</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row mt-4">
						<div class="col-6 form-group">
							<button type="submit" class="btn btn-primary"
								th:text="#{common.submit}">Submit</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<script th:inline="javascript">
			$("#file-1").change(()=>{
				let filename = $("#file-1").val();
				$("#filename").html(filename.replace(/^.*\\/, ""))
			});
		</script>
	</div>
</body>
</html>